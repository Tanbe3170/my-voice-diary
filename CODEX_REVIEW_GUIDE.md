# 📋 codex-review 実行ガイド

## 🎯 目的

各Phase完了後に、成果物の品質を保証するため、必ずcodex-reviewを実施します。

---

## 📦 codex-review SKILL の概要

**場所:** `.claude/skills/codex-review/SKILL.md`

**機能:**
- レビュー対象が大きい場合は自動分割
- サブエージェントによる並列レビュー
- 修正→再レビューの自動ループ（最大5回）
- read-onlyモードで安全に実行

---

## ✅ 実行タイミング

以下の場合に必ず実行：
- ✅ Phase完了時（全タスク完了後）
- ✅ 大きな機能追加後
- ✅ リファクタリング後

---

## 🚀 実行手順（初心者向け）

### **ステップ1: Phase完了の確認（3分）**
```bash
# 現在のディレクトリ確認
pwd
# 期待: ~/diary

# Gitステータス確認（未コミットの変更がないか）
git status

# 全ファイルがコミット済みであることを確認
```

**期待される状態:**
- ✅ 全ての変更がコミット済み
- ✅ `nothing to commit, working tree clean`

---

### **ステップ2: レビュー対象の特定（5分）**

**Phase 2の例:**

レビュー対象ディレクトリ/ファイル:
```
docs/
├── index.html
├── diary-input.html
├── style.css
├── app.js
├── manifest.json
└── service-worker.js
```

**確認コマンド:**
```bash
# レビュー対象ファイルの存在確認
ls -la docs/

# ファイル数の確認
ls docs/ | wc -l
```

---

### **ステップ3: VSCodeでClaude Codeを開く（1分）**
```bash
# VSCodeを起動
code ~/diary
```

VSCode内で：
1. 左サイドバーの「Claude Code」アイコンをクリック
2. 新しい会話を開始

---

### **ステップ4: codex-reviewの実行依頼（2分）**

**Claude Codeへの依頼文（コピー&ペースト）:**
```
Phase 2 が完了したので、codex-review を実施してください。

【レビュー対象】
docs/ ディレクトリ配下の全ファイル

【要件】
- .claude/skills/codex-review/SKILL.md を参照
- レビュー対象が大きい場合は適切に分割
- --sandbox かつ read-only モードで実行
- レビュー→修正→再レビューを最大5回まで繰り返し
- すべての指摘事項を記録

【期待される出力】
- レビュー結果のサマリー
- 指摘事項一覧
- 修正内容（修正が発生した場合）
- 最終判定（Pass/要追加修正）
```

---

### **ステップ5: レビュー結果の確認（5分）**

Claude Codeが返す情報を確認：

#### **パターンA: 指摘事項なし（Pass）**
```
✅ codex-review 完了

【レビュー結果】
- 対象ファイル数: 6
- 指摘事項: なし
- 判定: Pass

Phase 2 の成果物は品質基準を満たしています。
```

→ **ステップ7（完了記録）へ進む**

---

#### **パターンB: 指摘事項あり（要修正）**
```
⚠️ codex-review 第1回

【レビュー結果】
- 対象ファイル数: 6
- 指摘事項: 3件

【指摘内容】
1. docs/app.js:45
   - エラーハンドリングが不足
   - 推奨: try-catch ブロックを追加

2. docs/style.css:120
   - ブラウザ互換性の問題
   - 推奨: ベンダープレフィックスを追加

3. docs/manifest.json:10
   - 不要なプロパティが存在
   - 推奨: 削除

【修正中...】
```

→ **Claude Codeが自動で修正し、再レビューを開始**

---

### **ステップ6: 修正サイクルの監視（10分）**

Claude Codeは自動的に以下を繰り返します：
```
修正 → 再レビュー → 修正 → 再レビュー ...
（最大5回まで）
```

**あなたがすること:**
- ✅ 進捗を見守る
- ✅ 修正内容を確認
- ⚠️ 無限ループに入っていないか確認

**完了条件:**
- ✅ 指摘事項がゼロになった
- ✅ または5回のサイクルが完了

---

### **ステップ7: レビュー結果の記録（5分）**

**PROJECT_OVERVIEW.mdに追記:**
```bash
# ファイルを開く
nano PROJECT_OVERVIEW.md
# または
code PROJECT_OVERVIEW.md
```

**追記内容例:**
```markdown
### Phase 2（完了） - 2026-02-14

#### codex-review 実施結果
- 実施日: 2026-02-14
- レビュー対象: docs/ 配下 6ファイル
- レビューサイクル: 2回
- 指摘事項: 3件 → 修正完了
- 最終判定: ✅ Pass

**主な修正内容:**
1. app.js: エラーハンドリング追加
2. style.css: ベンダープレフィックス追加
3. manifest.json: 不要プロパティ削除
```

**保存してコミット:**
```bash
git add PROJECT_OVERVIEW.md
git commit -m "docs: Add codex-review results for Phase 2"
git push origin main
```

---

## ⚠️ トラブルシューティング

### **問題1: Claude Codeがタイムアウトする**

**原因:** レビュー対象が大きすぎる

**解決策:**
```
レビュー対象を分割してください。

【分割例: Phase 2】
1回目: docs/index.html, docs/diary-input.html
2回目: docs/style.css, docs/app.js
3回目: docs/manifest.json, docs/service-worker.js
```

---

### **問題2: 修正サイクルが無限ループ**

**原因:** 同じ指摘が繰り返される

**解決策:**
1. 5回目で強制終了させる
2. 手動で修正を確認
3. 必要に応じて手動修正
```bash
# 修正内容を確認
git diff

# 手動で修正（必要な場合）
code docs/app.js
```

---

### **問題3: SKILLファイルが見つからない**

**確認コマンド:**
```bash
# SKILLファイルの存在確認
ls -la .claude/skills/codex-review/SKILL.md
```

**解決策:**
ファイルが存在しない場合は、再作成してください。

---

## 📊 レビューサイクルの例

### Phase 2 の例
```
第1回レビュー
├─ 指摘3件
├─ 修正実施
└─ 第2回レビュー
    ├─ 指摘1件
    ├─ 修正実施
    └─ 第3回レビュー
        ├─ 指摘なし
        └─ ✅ Pass
```

---

## ✅ チェックリスト

codex-review完了前に確認：
```
□ Phase の全タスクが完了している
□ Git にすべての変更がコミット済み
□ レビュー対象を正しく指定した
□ Claude Code が正常に動作している
□ レビュー結果を確認した
□ 修正内容を理解した
□ PROJECT_OVERVIEW.md に記録した
□ Git にコミット・プッシュした
```

---

## 🎓 重要な原則

1. **必ず実行する**
   - Phase完了時は必須
   - 作業漏れを防ぐ

2. **結果を記録する**
   - どんな指摘があったか
   - どう修正したか
   - 次回の参考にする

3. **理解してから進む**
   - 修正内容を確認
   - なぜ修正が必要だったか理解
   - 次回同じミスをしない

---

**作成日:** 2026-02-14  
**更新日:** 2026-02-14  
**適用Phase:** Phase 2〜